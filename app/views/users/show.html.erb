<div style="margin: 120px 150px 24px 48px;">
    <%= link_to "Back to pets", pets_path, class: "back" %>
</div>
  <div class="container-profile" style=" margin: 0px 150px 0px 0px;padding: 0px; display:flex; justify-content:flex-start;">
    <div class="profile-banner flex-shrink-0 sticky-top">
      <div class="profile-img">
        <%= cl_image_tag current_user.photo.key, height: 150, width: 150,  crop: :fill %>
      </div>
      <div class="profile-info">
        <div id="profile-name">
          <span><%= current_user.first_name %></span>
          <span><%= current_user.last_name %></span>
        </div>
        <p><%= current_user.email %></p>
        <p><%= current_user.address %></p>
      </div>
    </div>
    <div class="profile-right">
      <nav style="height: 50px;">
        <div class="nav nav-tabs " id="nav-tab" role="tablist">
          <a class="nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="true">Playdates</a>
          <a class="nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="false">Conversations</a>
          <a class="nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Favourite Pets</a>
        </div>
      </nav>
      <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
          <h2>Your Playdates</h2>
          <hr>
          <% current_user.enquiries.each do |enquiry| %>
            <div>
              <div class=" enquiry mb-2">
                <div class="enquiry-img">
                  <%= cl_image_tag enquiry.pet.photos.first.key, height: 150, width: 150, crop: :fill, :class=> 'round-img'%>
                </div>
                <div>
                  <%= link_to enquiry.pet.name, pet_path(enquiry.pet), :class => "back"%>
                  <h4>Visit date: <strong><%= enquiry.date.strftime('%A, %d %b %Y %l:%M %p') %></strong></h4>
                  <h4>Location: <strong><%= enquiry.user.address %></strong></h4>
                  <p style= "font-size: 12px; font-style: italic; margin-top:16px;"><%= enquiry.pet.description %></p>
                  <%= simple_form_for Conversation.new do |f| %>
                    <%= f.hidden_field :recipient_id, value: enquiry.pet.user.id %>
                    <%= f.submit "Back to Chat with #{enquiry.pet.user.company_name}" %>
                  <% end %>
                </div>
              </div>
            </div>
            <hr>
          <% end %>
        </div>
        <div class="tab-pane fade " id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
          <h2>Your Conversations</h2>
          <hr>
          <ul>
            <% @conversations.each do |c| %>
              <div class=" conversation container border">
                <!-- TODO: Grab the sender name from the sender_id -->
                <% if c.messages.any? %>
                  <h4>Your chat with <strong><%= c.recipient.company_name %></strong> </h4>
                  <% if c.messages.last.user_id == current_user.id %>
                    <%= link_to "You wrote: #{c.messages.last.body}", conversation_path(c.id),class: "back" %>
                  <% else %>
                  <h4 class="font-weight-bold"><%= "New message"%></h4>
                    <%= link_to "#{c.messages.last.user.nickname} wrote: #{c.messages.last.body}", conversation_path(c.id), class: "back" %>
                  <% end %>
                <% else %>
                  <p><%= link_to "This is a brand new conversation", conversation_path(c.id) %></p>
                <% end %>
              </div>
            <% end %>
          </ul>
        </div>
        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
          <h2>Your favourite pets</h2>
          <hr>
          <div class ="favourite-container">
            <% @favorite_pets.each do |f| %>
              <div class=" favourite-card">
                <%= cl_image_tag f.pet.photos.first.key, height: 150, width: 150, crop: :fill, :class=> 'round-img'%>
                <div>
                  <h3 class="mb-1 mt-2"><%= f.pet.name %> </h3>
                  <p style="font-size: 14px; font-weight: bolder; margin-bottom: 0px;"><%= f.pet.breed %></p>
                  <p style="font-size: 12px; font-weight: lighter; margin-bottom: 14px;"><%= f.pet.age %> years old</p>
                  <%= link_to 'View pet', pet_path(f.pet), class: 'more-info' %>
                </div>
              </div>
              <hr>
            <% end %>
          </div>
        </div>
      </div>
     </div>
  </div>



